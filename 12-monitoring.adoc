
[[monitoring]]
== Monitoring

!! This chapter is still under construction !!

Monitoring a large CloudForms installation is an essential part of ensuring its continued smooth running. This reference architecture has provided examples of 

=== Database Appliance

It is recommended that the following items are monitored on the VMDB appliance:

* VMDB disk space utilization - monitor and forecast when 80% of filesystem will become filled. Track actual disk consumption versus expected consumption
* CPU utilization. A steady state utilization approaching 80% may indicate that VMDB appliance scaling or region redesign is required
* Memory utilization, especially swap usage
* I/O throughput - use the sysstat or iotop tools to monitor I/O utilization, throughput, and I/O wait state processing
* Review the number of miq_queue messages in "ready" state
* Ensure that the database maintenance scripts run regularly

=== CFME 'Worker' Appliances

For non-VMDB or "worker" appliances operational limits are often established on a per-appliance basis, and depend on the enabled server roles and number of worker processes. The following items are typically monitored:

==== General Appliance

* CPU utilization
* Memory utilization, especially swap usage
* Check for message timeouts

==== Workers

* Rates and reasons for worker process restarts
** Increase allocated memory if workers are exceeding memory thresholds

===== Provider Refresh

* Provider refresh activity and especially full refresh rates 
** How many full refreshes per day?
** How long does a refresh take by provider instance?
*** Data extraction component
*** Database load component
** Are certain property changes triggering too many refreshes?

===== Capacity & Utilization

* Are any realtime metrics being lost?
* How long does metrics collection take?
** Data extraction component
** Database load component
* Are rollups completing in time?

===== Automate

* Are any requests staying in a "pending" state for a long time?
* Check for state machine retries or timeouts exceeded
* Monitor provisioning failures

===== Event Monitoring

* Operation of appliances with Event Monitor role enabled

===== SmartState Analysis

* Monitor utilization of appliances with SmartProxy role enabled when scheduled scans are running
* Review scan failures/aborts

===== Reporting 

* Monitor utilization of appliances with Reporting role enabled when periodic reports are running.

=== Alerts

Some self-protection policies are available out-of-the-box in the form of alerts. <<i12-1>> shows the alert types that are available. Each is configurable to send an  email, an SNMP trap, or run an automate instance.


[[i12-1]]
.EVM Self-Monitoring Alerts
image::images/alerts.png[Screenshot,400,align="center"]
{zwsp} +


[NOTE]
====
EVM Worker Started and EVM Worker Stopped events are normal occurrences and should not be considered cause for alarm
====
